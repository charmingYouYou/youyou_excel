import{_ as $,d as K,a as A,r as O,o as W,c as g,b as l,w as n,u as c,e as i,t as f,F as D,i as C,E as v,f as d,g as y,h as x,j as q,q as J,p as P,k as T}from"./index.9a6e35df.js";import{g as I,J as U,X as h}from"./index.8c579c08.js";const S=F=>(P("data-v-6f88699a"),F=F(),T(),F),Z={class:"bg"},G=S(()=>i("i",{class:"el-icon-upload"},null,-1)),H=S(()=>i("div",{class:"el-upload__text"},[x("\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),i("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1)),Q={class:"el-upload__tip"},Y={style:{color:"red"}},ee={class:"table-header"},oe=K({__name:"index",setup(F){const k=["application/zip","application/x-zip-compressed"],E=A([]);let w="";const B=A("\u5F53\u524D\u5904\u7406\u8FDB\u5EA6: 0/0"),p=O({keys:"",areaIdKey:""}),V=()=>{console.log(123)},j=a=>{if(console.log(a),k.includes(a.type)){E.value=[],w=I(a.name);const o=new FileReader;o.readAsArrayBuffer(a),o.onload=()=>{const t=o.result;t instanceof ArrayBuffer&&N(new Blob([t]))}}else v.error("\u4EC5\u80FD\u4E0A\u4F20zip\u538B\u7F29\u5305");return!1},N=async a=>{try{const o=await U.loadAsync(a,{decodeFileName:e=>new TextDecoder("gbk").decode(e)}),t=Object.values(o.files).filter(e=>(e.name.endsWith(".dbf")||e.name.endsWith(".xlsx"))&&!e.dir&&!e.name.includes("__MACOSX"));z(t)}catch(o){console.log(o),v.error("\u89E3\u538B\u7F29\u5931\u8D25")}},z=async a=>{const o=await Promise.all(a.map(async e=>{const u=I(e.name).replace("dt","");console.log("\u89E3\u538B\u6587\u4EF6:",e,u);let r=null;return"async"in e&&(r=await e.async("arraybuffer")),{buffer:r,fileId:u}})),t=new Worker("/youyou_excel/worker.js");t.postMessage({key:"ld21ExcelInside",type:"data",data:o,extra:{...p}}),t.addEventListener("message",e=>{const{key:u,type:r,data:m}=e.data;u==="ld21ExcelInside"&&(r==="message"?B.value=m:r==="data"&&(E.value=Object.values(m),console.log(m,"----------"),t.terminate()))})},L=a=>{const o=h.utils.book_new(),t=document.querySelector(`.${a}`),e=h.utils.table_to_sheet(t);h.utils.book_append_sheet(o,e,w),h.writeFile(o,`${w}.xlsx`)};return W(()=>{}),(a,o)=>{const t=d("el-upload"),e=d("el-input"),u=d("el-form-item"),r=d("el-form"),m=d("el-button"),b=d("el-table-column"),M=d("el-table");return y(),g("div",Z,[l(t,{class:"upload-demo",drag:"",action:"https://jsonplaceholder.typicode.com/posts/",multiple:!1,"before-upload":j,"on-change":V,accept:k.join(",")},{tip:n(()=>[i("div",Q,"\u53EA\u80FD\u4E0A\u4F20"+f(k.join(","))+"\u6587\u4EF6",1)]),default:n(()=>[G,H]),_:1},8,["accept"]),l(r,{ref:"formRef",model:c(p)},{default:n(()=>[l(u,{label:"\u989D\u5916\u8868\u5934\u540D\u79F0"},{default:n(()=>[l(e,{modelValue:c(p).keys,"onUpdate:modelValue":o[0]||(o[0]=s=>c(p).keys=s),placeholder:"\u5982: ld21"},null,8,["modelValue"])]),_:1}),l(u,{label:"\u5730\u533AID\u8868\u5934\u540D\u79F0"},{default:n(()=>[l(e,{modelValue:c(p).areaIdKey,"onUpdate:modelValue":o[1]||(o[1]=s=>c(p).areaIdKey=s),placeholder:"\u9ED8\u8BA4: pac, \u4E0D\u533A\u5206\u5927\u5C0F\u5199"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),i("p",Y,f(c(B)),1),(y(!0),g(D,null,C(c(E),s=>(y(),g(D,null,[i("header",ee,[i("h1",null,f(s.title)+"\u8868\u683C\u6570\u636E",1),l(m,{type:"primary",style:{width:"100px"},onClick:_=>L(s.title)},{default:n(()=>[x(" \u4E0B\u8F7D\u8868\u683C ")]),_:2},1032,["onClick"])]),l(M,{data:s.info,border:"","max-height":"800",class:J(s.title)},{default:n(()=>[l(b,{type:"index"}),l(b,{prop:"error",label:"\u72B6\u6001",align:"center"},{default:n(_=>[x(f(_.row.error?"\u5931\u8D25":"\u6210\u529F"),1)]),_:1}),l(b,{prop:"pac",label:"\u5730\u533AID",align:"center"}),(y(!0),g(D,null,C(s.keys,(_,R)=>(y(),q(b,{key:`ld2020_${R}`,prop:String(_),label:String(_),align:"center"},{default:n(X=>[x(f(Number(X.row[_]||0).toFixed(3)),1)]),_:2},1032,["prop","label"]))),128))]),_:2},1032,["data","class"])],64))),256))])}}});var le=$(oe,[["__scopeId","data-v-6f88699a"]]);export{le as default};
