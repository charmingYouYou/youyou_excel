import{_ as X,d as J,r as O,a as x,o as W,c as D,b as u,w as l,u as c,e as _,t as p,E as A,f as s,g as B,h as y,F as P,i as T,j as Z,p as $,k as q}from"./index.9a6e35df.js";import{g as C,J as U,X as b}from"./index.8c579c08.js";const S=m=>($("data-v-2b44a5c4"),m=m(),q(),m),G={class:"bg"},H=S(()=>_("i",{class:"el-icon-upload"},null,-1)),K=S(()=>_("div",{class:"el-upload__text"},[y("\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),_("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1)),Q={class:"el-upload__tip"},Y={style:{color:"red"}},ee=J({__name:"index",setup(m){const E=["application/zip","application/x-zip-compressed"],f=O({keys:""}),g=x([]),k=x([]);let h="";const w=x("\u5F53\u524D\u5904\u7406\u8FDB\u5EA6: 0/0"),v=()=>{console.log(123)},L=t=>{if(console.log(t),E.includes(t.type)){h=C(t.name);const o=new FileReader;o.readAsArrayBuffer(t),o.onload=()=>{const a=o.result;a instanceof ArrayBuffer&&N(new Blob([a]))}}else A.error("\u4EC5\u80FD\u4E0A\u4F20zip\u538B\u7F29\u5305");return!1},N=async t=>{try{const o=await U.loadAsync(t,{decodeFileName:e=>new TextDecoder("gbk").decode(e)}),a=Object.values(o.files).filter(e=>(e.name.endsWith(".dbf")||e.name.endsWith(".xlsx"))&&!e.dir&&!e.name.includes("__MACOSX"));I(a)}catch(o){console.log(o),A.error("\u89E3\u538B\u7F29\u5931\u8D25")}},I=async t=>{const o=await Promise.all(t.map(async e=>{console.log("\u89E3\u538B\u6587\u4EF6:",e);const d=C(e.name).replace("ld","");let n=null;return"async"in e&&(n=await e.async("arraybuffer")),{buffer:n,fileId:d}})),a=new Worker("/youyou_excel/worker.js");a.postMessage({key:"ld2020Excel",type:"data",data:o,extra:{...f}}),a.addEventListener("message",e=>{const{key:d,type:n,data:i}=e.data;d==="ld2020Excel"&&(n==="message"?w.value=i:n==="data"&&(k.value=i.LD2020List,g.value=i.areaJSON,console.log(i,"----------"),a.terminate()))})},j=()=>{const t=b.utils.book_new(),o=document.querySelector(".el-table"),a=b.utils.table_to_sheet(o);b.utils.book_append_sheet(t,a,h),b.writeFile(t,`${h}.xlsx`)};return W(()=>{}),(t,o)=>{const a=s("el-alert"),e=s("el-upload"),d=s("el-input"),n=s("el-form-item"),i=s("el-form"),V=s("el-button"),F=s("el-table-column"),z=s("el-table");return B(),D("div",G,[u(a,{title:"\u529F\u80FD\u4ECB\u7ECD",type:"info",description:"\u89E3\u6790\u6587\u4EF6\u533A\u57DFid, \u5E76\u81EA\u5B9A\u4E49\u8868\u5934\u540D\u79F0, \u6839\u636E\u6539\u540D\u79F0\u5BF9area\u8FDB\u884C\u6C42\u548C\u8BA1\u7B97","show-icon":""}),u(e,{class:"upload-demo",drag:"",action:"https://jsonplaceholder.typicode.com/posts/",multiple:!1,"before-upload":L,"on-change":v,accept:E.join(",")},{tip:l(()=>[_("div",Q,"\u53EA\u80FD\u4E0A\u4F20"+p(E.join(","))+"\u6587\u4EF6",1)]),default:l(()=>[H,K]),_:1},8,["accept"]),u(i,{ref:"formRef",model:c(f)},{default:l(()=>[u(n,{label:"\u989D\u5916\u8868\u5934\u540D\u79F0"},{default:l(()=>[u(d,{modelValue:c(f).keys,"onUpdate:modelValue":o[0]||(o[0]=r=>c(f).keys=r),placeholder:"\u5982: ld2023"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),_("p",Y," \u538B\u7F29\u5305\u5171\u8BA1"+p(c(g).length)+"\u4E2A\u6587\u4EF6, "+p(c(w)),1),u(V,{type:"primary",style:{width:"100px"},onClick:j},{default:l(()=>[y(" \u4E0B\u8F7D\u8868\u683C ")]),_:1}),u(z,{data:c(g),border:"","max-height":"800"},{default:l(()=>[u(F,{type:"index"}),u(F,{prop:"error",label:"\u72B6\u6001",align:"center"},{default:l(r=>[y(p(r.row.error?"\u5931\u8D25":"\u6210\u529F"),1)]),_:1}),u(F,{prop:"fileId",label:"fileId",align:"center"}),(B(!0),D(P,null,T(c(k),(r,M)=>(B(),Z(F,{key:`ld2020_${M}`,prop:r,label:r,align:"center"},{default:l(R=>[y(p(Number(R.row[r]||0).toFixed(3)),1)]),_:2},1032,["prop","label"]))),128))]),_:1},8,["data"])])}}});var ae=X(ee,[["__scopeId","data-v-2b44a5c4"]]);export{ae as default};
