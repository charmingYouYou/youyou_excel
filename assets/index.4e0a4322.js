import{_ as q,d as J,a as B,r as O,o as P,c as F,b as l,w as a,u as _,e as d,t as m,F as D,i as S,E as L,f as c,g as f,h as k,j as T,q as W,p as Z,k as H}from"./index.9a6e35df.js";import{g as v,J as U,X as h}from"./index.8c579c08.js";const I=b=>(Z("data-v-6bb0c018"),b=b(),H(),b),G={class:"bg"},K=I(()=>d("i",{class:"el-icon-upload"},null,-1)),Q=I(()=>d("div",{class:"el-upload__text"},[k("\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),d("em",null,"\u70B9\u51FB\u4E0A\u4F20")],-1)),Y={class:"el-upload__tip"},ee={style:{color:"red"}},oe={class:"table-header"},te=J({__name:"index",setup(b){const w=["application/zip","application/x-zip-compressed"],x=B([]);let E="";const C=B("\u5F53\u524D\u5904\u7406\u8FDB\u5EA6: 0/0"),y=O({keys:""}),A=B(""),$=()=>{console.log(123)},j=t=>{if(console.log(t),w.includes(t.type)){x.value=[],E=v(t.name);const o=new FileReader;o.readAsArrayBuffer(t),o.onload=()=>{const s=o.result;s instanceof ArrayBuffer&&N(new Blob([s]))}}else L.error("\u4EC5\u80FD\u4E0A\u4F20zip\u538B\u7F29\u5305");return!1},N=async t=>{try{const o=await U.loadAsync(t,{decodeFileName:e=>new TextDecoder("gbk").decode(e)}),s=Object.values(o.files).filter(e=>e.name.endsWith(".dbf")&&!e.dir&&!e.name.includes("__MACOSX"));V(s)}catch(o){console.log(o),L.error("\u89E3\u538B\u7F29\u5931\u8D25")}},V=async t=>{const o=await Promise.all(t.map(async e=>{const n=v(e.name).substring(2);A.value=v(e.name).substring(0,2).toLowerCase(),console.log("\u89E3\u538B\u6587\u4EF6:",e,n);let u=null;return"async"in e&&(u=await e.async("arraybuffer")),{buffer:u,fileId:n}})),s=new Worker("/youyou_excel/worker.js");s.postMessage({key:"ld2021Excel",type:"data",data:o,extra:{...y}}),s.addEventListener("message",e=>{const{key:n,type:u,data:i}=e.data;n==="ld2021Excel"&&(u==="message"?C.value=i:u==="data"&&(x.value=[i.ld20List,i.ld21List],console.log(i,"----------"),s.terminate()))})},z=t=>{const o=h.utils.book_new(),s=document.querySelector(`.table${t}`),e=h.utils.table_to_sheet(s);h.utils.book_append_sheet(o,e,E),h.writeFile(o,`${E}-${A.value}${t}.xlsx`)};return P(()=>{}),(t,o)=>{const s=c("el-upload"),e=c("el-input"),n=c("el-form-item"),u=c("el-form"),i=c("el-button"),g=c("el-table-column"),M=c("el-table");return f(),F("div",G,[l(s,{class:"upload-demo",drag:"",action:"https://jsonplaceholder.typicode.com/posts/",multiple:!1,"before-upload":j,"on-change":$,accept:w.join(",")},{tip:a(()=>[d("div",Y,"\u53EA\u80FD\u4E0A\u4F20"+m(w.join(","))+"\u6587\u4EF6",1)]),default:a(()=>[K,Q]),_:1},8,["accept"]),l(u,{ref:"formRef",model:_(y)},{default:a(()=>[l(n,{label:"\u989D\u5916\u8868\u5934\u540D\u79F0"},{default:a(()=>[l(e,{modelValue:_(y).keys,"onUpdate:modelValue":o[0]||(o[0]=r=>_(y).keys=r),placeholder:"\u5982: ld20,ld21"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),d("p",ee,m(_(C)),1),(f(!0),F(D,null,S(_(x),r=>(f(),F(D,null,[d("header",oe,[d("h1",null,m(r.title)+"\u8868\u683C\u6570\u636E",1),l(i,{type:"primary",style:{width:"100px"},onClick:p=>z(r.title)},{default:a(()=>[k(" \u4E0B\u8F7D\u8868\u683C ")]),_:2},1032,["onClick"])]),l(M,{data:r.info,border:"","max-height":"800",class:W(`table${r.title}`)},{default:a(()=>[l(g,{type:"index"}),l(g,{prop:"error",label:"\u72B6\u6001",align:"center"},{default:a(p=>[k(m(p.row.error?"\u5931\u8D25":"\u6210\u529F"),1)]),_:1}),l(g,{prop:"fileId",label:"\u5730\u533AID",align:"center"}),(f(!0),F(D,null,S(r.keys,(p,R)=>(f(),T(g,{key:`ld2020_${R}`,prop:String(p),label:String(p),align:"center"},{default:a(X=>[k(m(Number(X.row[p]||0).toFixed(3)),1)]),_:2},1032,["prop","label"]))),128))]),_:2},1032,["data","class"])],64))),256))])}}});var ae=q(te,[["__scopeId","data-v-6bb0c018"]]);export{ae as default};
